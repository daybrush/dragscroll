{"version":3,"file":"dragscroll.min.js","sources":["../src/DragScroll.ts"],"sourcesContent":["import EventEmitter from \"@scena/event-emitter\";\nimport { now } from \"@daybrush/utils\";\nimport { DragScrollEvents, DragScrollOptions, Rect } from \"./types\";\n\nfunction getDefaultScrollPosition(e: { container: HTMLElement, direction: number[] }) {\n    let container = e.container;\n\n    if (container === document.body) {\n        return [\n            container.scrollLeft || document.documentElement.scrollLeft,\n            container.scrollTop || document.documentElement.scrollTop,\n        ];\n    }\n    return [\n        container.scrollLeft,\n        container.scrollTop,\n    ];\n}\n\nexport default class DragScroll extends EventEmitter<DragScrollEvents> {\n    private startRect: Rect | null = null;\n    private startPos: number[] = [];\n    private prevTime: number = 0;\n    private timer: number = 0;\n    public dragStart(e: any, options: DragScrollOptions) {\n        const container = options.container;\n        let top = 0;\n        let left = 0;\n        let width = 0;\n        let height = 0;\n\n        if (container === document.body) {\n            width = window.innerWidth;\n            height = window.innerHeight;\n        } else {\n            const rect = container.getBoundingClientRect();\n\n            top = rect.top;\n            left = rect.left;\n            width = rect.width;\n            height = rect.height;\n        }\n\n        this.startPos = [e.clientX, e.clientY];\n        this.startRect = { top, left, width, height };\n    }\n    public drag(e: any, options: DragScrollOptions) {\n        const {\n            clientX,\n            clientY,\n        } = e;\n        const {\n            container,\n            threshold = 0,\n            throttleTime = 0,\n            getScrollPosition = getDefaultScrollPosition,\n        } = options;\n        const {\n            startRect,\n            startPos,\n        } = this;\n        const nowTime = now();\n        const distTime = Math.max(throttleTime + this.prevTime - nowTime, 0);\n\n        const direction = [0, 0];\n\n        if (startRect.top > clientY - threshold) {\n            if (startPos[1] > startRect.top || clientY < startPos[1]) {\n                direction[1] = -1;\n            }\n        } else if (startRect.top + startRect.height < clientY + threshold) {\n            if (startPos[1] < startRect.top + startRect.height || clientY > startPos[1]) {\n                direction[1] = 1;\n            }\n        }\n        if (startRect.left > clientX - threshold) {\n            if (startPos[0] > startRect.left || clientX < startPos[0]) {\n                direction[0] = -1;\n            }\n        } else if (startRect.left + startRect.width < clientX + threshold) {\n            if (startPos[0] < startRect.left + startRect.width || clientX > startPos[0]) {\n                direction[0] = 1;\n            }\n        }\n        clearTimeout(this.timer);\n\n        if (!direction[0] && !direction[1]) {\n            return false;\n        }\n        if (distTime > 0) {\n            this.timer = window.setTimeout(() => {\n                this.drag(e, options);\n            }, distTime);\n\n            return false;\n        }\n        this.prevTime = nowTime;\n        const prevPos = getScrollPosition({ container, direction });\n\n        this.trigger(\"scroll\", {\n            container,\n            direction,\n            inputEvent: e,\n        });\n\n        const nextPos = getScrollPosition({ container, direction });\n        const offsetX = nextPos[0] - prevPos[0];\n        const offsetY = nextPos[1] - prevPos[1];\n\n        if (!offsetX && !offsetY) {\n            return false;\n        }\n        this.trigger(\"move\", {\n            offsetX: direction[0] ? offsetX : 0,\n            offsetY: direction[1] ? offsetY : 0,\n            inputEvent: e,\n        });\n\n        if (throttleTime) {\n            this.timer = window.setTimeout(() => {\n                this.drag(e, options);\n            }, throttleTime);\n        }\n        return true;\n    }\n    public dragEnd() {\n        clearTimeout(this.timer);\n    }\n}\n"],"names":["getDefaultScrollPosition","e","container","document","body","scrollLeft","documentElement","scrollTop","_this","options","top","left","width","height","window","innerWidth","innerHeight","rect","getBoundingClientRect","startPos","clientX","clientY","startRect","_a","threshold","_b","throttleTime","_c","getScrollPosition","nowTime","distTime","Math","max","this","prevTime","direction","clearTimeout","timer","setTimeout","drag","prevPos","trigger","inputEvent","nextPos","offsetX","offsetY"],"mappings":";;;;;;;;snBAIA,SAASA,EAAyBC,OAC1BC,EAAYD,EAAEC,iBAEdA,IAAcC,SAASC,KAChB,CACHF,EAAUG,YAAcF,SAASG,gBAAgBD,WACjDH,EAAUK,WAAaJ,SAASG,gBAAgBC,WAGjD,CACHL,EAAUG,WACVH,EAAUK,wIAKNC,YAAyB,KACzBA,WAAqB,GACrBA,WAAmB,EACnBA,QAAgB,0HACxB,SAAiBP,EAAQQ,OACfP,EAAYO,EAAQP,UACtBQ,EAAM,EACNC,EAAO,EACPC,EAAQ,EACRC,EAAS,KAETX,IAAcC,SAASC,KACvBQ,EAAQE,OAAOC,WACfF,EAASC,OAAOE,gBACb,KACGC,EAAOf,EAAUgB,wBAEvBR,EAAMO,EAAKP,IACXC,EAAOM,EAAKN,KACZC,EAAQK,EAAKL,MACbC,EAASI,EAAKJ,YAGbM,SAAW,CAAClB,EAAEmB,QAASnB,EAAEoB,cACzBC,UAAY,CAAEZ,MAAKC,OAAMC,QAAOC,kBAEzC,SAAYZ,EAAQQ,cAEZW,YACAC,YAGAnB,cACAqB,cAAAC,iBACAC,iBAAAC,iBACAC,sBAAAC,iBAGAN,iBACAH,gBAEEU,2CACAC,EAAWC,KAAKC,IAAIN,EAAeO,KAAKC,SAAWL,EAAS,GAE5DM,EAAY,CAAC,EAAG,MAElBb,EAAUZ,IAAMW,EAAUG,GACtBL,EAAS,GAAKG,EAAUZ,KAAOW,EAAUF,EAAS,MAClDgB,EAAU,IAAM,GAEbb,EAAUZ,IAAMY,EAAUT,OAASQ,EAAUG,IAChDL,EAAS,GAAKG,EAAUZ,IAAMY,EAAUT,QAAUQ,EAAUF,EAAS,MACrEgB,EAAU,GAAK,GAGnBb,EAAUX,KAAOS,EAAUI,GACvBL,EAAS,GAAKG,EAAUX,MAAQS,EAAUD,EAAS,MACnDgB,EAAU,IAAM,GAEbb,EAAUX,KAAOW,EAAUV,MAAQQ,EAAUI,IAChDL,EAAS,GAAKG,EAAUX,KAAOW,EAAUV,OAASQ,EAAUD,EAAS,MACrEgB,EAAU,GAAK,GAGvBC,aAAaH,KAAKI,QAEbF,EAAU,KAAOA,EAAU,UACrB,KAEI,EAAXL,cACKO,MAAQvB,OAAOwB,WAAW,WAC3B9B,EAAK+B,KAAKtC,EAAGQ,IACdqB,IAEI,OAENI,SAAWL,MACVW,EAAUZ,EAAkB,CAAE1B,YAAWiC,mBAE1CM,QAAQ,SAAU,CACnBvC,YACAiC,YACAO,WAAYzC,QAGV0C,EAAUf,EAAkB,CAAE1B,YAAWiC,cACzCS,EAAUD,EAAQ,GAAKH,EAAQ,GAC/BK,EAAUF,EAAQ,GAAKH,EAAQ,YAEhCI,IAAYC,UAGZJ,QAAQ,OAAQ,CACjBG,QAAST,EAAU,GAAKS,EAAU,EAClCC,QAASV,EAAU,GAAKU,EAAU,EAClCH,WAAYzC,IAGZyB,SACKW,MAAQvB,OAAOwB,WAAW,WAC3B9B,EAAK+B,KAAKtC,EAAGQ,IACdiB,KAEA,cAEX,WACIU,aAAaH,KAAKI"}