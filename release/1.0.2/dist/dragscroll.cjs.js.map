{"version":3,"file":"dragscroll.cjs.js","sources":["../src/DragScroll.ts"],"sourcesContent":["import EventEmitter from \"@scena/event-emitter\";\nimport { now } from \"@daybrush/utils\";\nimport { DragScrollEvents, DragScrollOptions, Rect } from \"./types\";\n\nfunction getDefaultScrollPosition(e: { container: HTMLElement, direction: number[] }) {\n    let container = e.container;\n\n    if (container === document.body) {\n        return [\n            container.scrollLeft || document.documentElement.scrollLeft,\n            container.scrollTop || document.documentElement.scrollTop,\n        ];\n    }\n    return [\n        container.scrollLeft,\n        container.scrollTop,\n    ];\n}\n\nexport default class DragScroll extends EventEmitter<DragScrollEvents> {\n    private startRect: Rect | null = null;\n    private startPos: number[] = [];\n    private prevTime: number = 0;\n    private timer: number = 0;\n    public dragStart(e: any, options: DragScrollOptions) {\n        const container = options.container;\n        let top = 0;\n        let left = 0;\n        let width = 0;\n        let height = 0;\n\n        if (container === document.body) {\n            width = window.innerWidth;\n            height = window.innerHeight;\n        } else {\n            const rect = container.getBoundingClientRect();\n\n            top = rect.top;\n            left = rect.left;\n            width = rect.width;\n            height = rect.height;\n        }\n\n        this.startPos = [e.clientX, e.clientY];\n        this.startRect = { top, left, width, height };\n    }\n    public drag(e: any, options: DragScrollOptions) {\n        const {\n            clientX,\n            clientY,\n        } = e;\n        const {\n            container,\n            threshold = 0,\n            throttleTime = 0,\n            getScrollPosition = getDefaultScrollPosition,\n        } = options;\n        const {\n            startRect,\n            startPos,\n        } = this;\n        const nowTime = now();\n        const distTime = Math.max(throttleTime + this.prevTime - nowTime, 0);\n\n        const direction = [0, 0];\n\n        if (startRect.top > clientY - threshold) {\n            if (startPos[1] > startRect.top || clientY < startPos[1]) {\n                direction[1] = -1;\n            }\n        } else if (startRect.top + startRect.height < clientY + threshold) {\n            if (startPos[1] < startRect.top + startRect.height || clientY > startPos[1]) {\n                direction[1] = 1;\n            }\n        }\n        if (startRect.left > clientX - threshold) {\n            if (startPos[0] > startRect.left || clientX < startPos[0]) {\n                direction[0] = -1;\n            }\n        } else if (startRect.left + startRect.width < clientX + threshold) {\n            if (startPos[0] < startRect.left + startRect.width || clientX > startPos[0]) {\n                direction[0] = 1;\n            }\n        }\n        clearTimeout(this.timer);\n\n        if (!direction[0] && !direction[1]) {\n            return false;\n        }\n        if (distTime > 0) {\n            this.timer = window.setTimeout(() => {\n                this.drag(e, options);\n            }, distTime);\n\n            return false;\n        }\n        this.prevTime = nowTime;\n        const prevPos = getScrollPosition({ container, direction });\n\n        this.trigger(\"scroll\", {\n            container,\n            direction,\n            inputEvent: e,\n        });\n\n        const nextPos = getScrollPosition({ container, direction });\n        const offsetX = nextPos[0] - prevPos[0];\n        const offsetY = nextPos[1] - prevPos[1];\n\n        if (!offsetX && !offsetY) {\n            return false;\n        }\n        this.trigger(\"move\", {\n            offsetX: direction[0] ? offsetX : 0,\n            offsetY: direction[1] ? offsetY : 0,\n            inputEvent: e,\n        });\n\n        if (throttleTime) {\n            this.timer = window.setTimeout(() => {\n                this.drag(e, options);\n            }, throttleTime);\n        }\n        return true;\n    }\n    public dragEnd() {\n        clearTimeout(this.timer);\n    }\n}\n"],"names":["getDefaultScrollPosition","e","container","document","body","scrollLeft","documentElement","scrollTop","__extends","_this","options","top","left","width","height","window","innerWidth","innerHeight","rect","getBoundingClientRect","startPos","clientX","clientY","startRect","_a","threshold","_b","throttleTime","_c","getScrollPosition","_d","nowTime","now","distTime","Math","max","prevTime","direction","clearTimeout","timer","setTimeout","drag","prevPos","trigger","inputEvent","nextPos","offsetX","offsetY","EventEmitter"],"mappings":"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"}