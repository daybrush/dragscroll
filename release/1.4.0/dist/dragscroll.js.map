{"version":3,"file":"dragscroll.js","sources":["../src/DragScroll.ts"],"sourcesContent":["import EventEmitter from \"@scena/event-emitter\";\nimport { isFunction, isString, now } from \"@daybrush/utils\";\nimport { CheckScrollOptions, DragScrollEvents, DragScrollOptions, Rect } from \"./types\";\n\nfunction getDefaultScrollPosition(e: { container: HTMLElement, direction: number[] }) {\n    let container = e.container;\n\n    if (container === document.body) {\n        return [\n            container.scrollLeft || document.documentElement.scrollLeft,\n            container.scrollTop || document.documentElement.scrollTop,\n        ];\n    }\n    return [\n        container.scrollLeft,\n        container.scrollTop,\n    ];\n}\n\nfunction checkDefaultScrollEvent(container: HTMLElement | Window, callback: () => void) {\n    container.addEventListener(\"scroll\", callback);\n\n    return () => {\n        container.removeEventListener(\"scroll\", callback);\n    }\n}\n\nfunction getContainerElement(container: DragScrollOptions[\"container\"]): HTMLElement {\n    if (!container) {\n        return null;\n    } else if (isString(container)) {\n        return document.querySelector<HTMLElement>(container);\n    } if (isFunction(container)) {\n        return container();\n    } else if (container instanceof Element) {\n        return container;\n    } else if (\"current\" in container) {\n        return container.current;\n    } else if (\"value\" in container) {\n        return container.value;\n    }\n}\n\n/**\n * @sort 1\n */\nclass DragScroll extends EventEmitter<DragScrollEvents> {\n    private _startRect: Rect | null = null;\n    private _startPos: number[] = [];\n    private _prevTime: number = 0;\n    private _timer: number = 0;\n    private _prevScrollPos: number[] = [0, 0];\n    private _isWait = false;\n    private _flag = false;\n    private _currentOptions: DragScrollOptions | null = null;\n    private _lock = false;\n    private _unregister: (() => void) | null = null;\n    /**\n     */\n    public dragStart(e: any, options: DragScrollOptions) {\n        const container = getContainerElement(options.container);\n\n        if (!container) {\n            this._flag = false;\n            return;\n        }\n        let top = 0;\n        let left = 0;\n        let width = 0;\n        let height = 0;\n\n        if (container === document.body) {\n            width = window.innerWidth;\n            height = window.innerHeight;\n        } else {\n            const rect = container.getBoundingClientRect();\n\n            top = rect.top;\n            left = rect.left;\n            width = rect.width;\n            height = rect.height;\n        }\n\n        this._flag = true;\n        this._startPos = [e.clientX, e.clientY];\n        this._startRect = { top, left, width, height };\n        this._prevScrollPos = this._getScrollPosition([0, 0], options);\n        this._currentOptions = options;\n        this._registerScrollEvent(options);\n    }\n    public drag(e: any, options: DragScrollOptions) {\n        clearTimeout(this._timer);\n        if (!this._flag) {\n            return;\n        }\n        const {\n            clientX,\n            clientY,\n        } = e;\n        const {\n            threshold = 0,\n        } = options;\n        const {\n            _startRect,\n            _startPos,\n        } = this;\n\n\n        this._currentOptions = options;\n        const direction = [0, 0];\n\n        if (_startRect.top > clientY - threshold) {\n            if (_startPos[1] > _startRect.top || clientY < _startPos[1]) {\n                direction[1] = -1;\n            }\n        } else if (_startRect.top + _startRect.height < clientY + threshold) {\n            if (_startPos[1] < _startRect.top + _startRect.height || clientY > _startPos[1]) {\n                direction[1] = 1;\n            }\n        }\n        if (_startRect.left > clientX - threshold) {\n            if (_startPos[0] > _startRect.left || clientX < _startPos[0]) {\n                direction[0] = -1;\n            }\n        } else if (_startRect.left + _startRect.width < clientX + threshold) {\n            if (_startPos[0] < _startRect.left + _startRect.width || clientX > _startPos[0]) {\n                direction[0] = 1;\n            }\n        }\n\n        if (!direction[0] && !direction[1]) {\n            return false;\n        }\n        return this._continueDrag({\n            ...options,\n            direction,\n            inputEvent: e,\n            isDrag: true,\n        });\n    }\n    /**\n     */\n    public checkScroll(options: CheckScrollOptions) {\n        if (this._isWait) {\n            return false;\n        }\n        const {\n            prevScrollPos = this._prevScrollPos,\n            direction,\n            throttleTime = 0,\n            inputEvent,\n            isDrag,\n        } = options;\n        const nextScrollPos = this._getScrollPosition(direction || [0, 0], options);\n        const offsetX = nextScrollPos[0] - prevScrollPos[0];\n        const offsetY = nextScrollPos[1] - prevScrollPos[1];\n\n        const nextDirection = direction || [\n            offsetX ? Math.abs(offsetX) / offsetX : 0,\n            offsetY ? Math.abs(offsetY) / offsetY : 0,\n        ];\n        this._prevScrollPos = nextScrollPos;\n        this._lock = false;\n\n        if (!offsetX && !offsetY) {\n            return false;\n        }\n        /**\n         * @event DragScroll#move\n         */\n        this.emit(\"move\", {\n            offsetX: nextDirection[0] ? offsetX : 0,\n            offsetY: nextDirection[1] ? offsetY : 0,\n            inputEvent,\n        });\n\n        if (throttleTime && isDrag) {\n            clearTimeout(this._timer);\n            this._timer = window.setTimeout(() => {\n                this._continueDrag(options);\n            }, throttleTime);\n        }\n        return true;\n    }\n    /**\n     *\n     */\n    public dragEnd() {\n        this._flag = false;\n        this._lock = false;\n        clearTimeout(this._timer);\n        this._unregisterScrollEvent();\n    }\n    private _getScrollPosition(direction: number[], options: DragScrollOptions) {\n        const {\n            container,\n            getScrollPosition = getDefaultScrollPosition,\n        } = options;\n        return getScrollPosition({ container: getContainerElement(container), direction });\n    }\n    private _continueDrag(options: CheckScrollOptions) {\n        const {\n            container,\n            direction,\n            throttleTime,\n            useScroll,\n            isDrag,\n            inputEvent,\n        } = options;\n\n        if (!this._flag || (isDrag && this._isWait)) {\n            return;\n        }\n        const nowTime = now();\n        const distTime = Math.max(throttleTime + this._prevTime - nowTime, 0);\n\n        if (distTime > 0) {\n            clearTimeout(this._timer);\n            this._timer = window.setTimeout(() => {\n                this._continueDrag(options);\n            }, distTime);\n\n            return false;\n        }\n        this._prevTime = nowTime;\n        const prevScrollPos = this._getScrollPosition(direction, options);\n\n        this._prevScrollPos = prevScrollPos;\n\n        if (isDrag) {\n            this._isWait = true;\n        }\n\n        // unregister native scroll event\n        if (!useScroll) {\n            this._lock = true;\n        }\n        const param = {\n            container: getContainerElement(container),\n            direction,\n            inputEvent,\n        };\n        options.requestScroll?.(param);\n        /**\n         * @event DragScroll#scroll\n         */\n        this.emit(\"scroll\", param);\n\n        this._isWait = false;\n        return useScroll || this.checkScroll({\n            ...options,\n            prevScrollPos,\n            direction,\n            inputEvent,\n        });\n    }\n\n    private _registerScrollEvent(options: DragScrollOptions) {\n        this._unregisterScrollEvent();\n        const checkScrollEvent = options.checkScrollEvent;\n\n        if (!checkScrollEvent) {\n            return;\n        }\n        const callback = checkScrollEvent === true ? checkDefaultScrollEvent : checkScrollEvent;\n        const container = getContainerElement(options.container);\n\n        if (checkScrollEvent === true && (container === document.body || container === document.documentElement)) {\n            this._unregister = checkDefaultScrollEvent(window, this._onScroll);\n        } else {\n            this._unregister = callback(container, this._onScroll);\n        }\n    }\n    private _unregisterScrollEvent() {\n        this._unregister?.();\n        this._unregister = null;\n    }\n\n    private _onScroll = () => {\n        const options = this._currentOptions;\n        if (this._lock || !options) {\n            return;\n        }\n\n        this.emit(\"scrollDrag\", {\n            next: (inputEvent: any) => {\n                this.checkScroll({\n                    container: options.container,\n                    inputEvent,\n                });\n            },\n        });\n    };\n}\n\nexport default DragScroll;\n"],"names":["getDefaultScrollPosition","e","container","document","body","scrollLeft","documentElement","scrollTop","checkDefaultScrollEvent","callback","addEventListener","removeEventListener","getContainerElement","isString","querySelector","isFunction","Element","current","value","__extends","_this","options","_currentOptions","_lock","emit","next","inputEvent","checkScroll","_flag","top","left","width","height","window","innerWidth","innerHeight","rect","getBoundingClientRect","_startPos","clientX","clientY","_startRect","_prevScrollPos","_getScrollPosition","_registerScrollEvent","clearTimeout","_timer","_a","threshold","_b","direction","_continueDrag","isDrag","_isWait","prevScrollPos","throttleTime","nextScrollPos","offsetX","offsetY","nextDirection","Math","abs","setTimeout","_unregisterScrollEvent","getScrollPosition","useScroll","nowTime","now","distTime","max","_prevTime","param","requestScroll","checkScrollEvent","_unregister","_onScroll","EventEmitter"],"mappings":"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"}