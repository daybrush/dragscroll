{"version":3,"file":"dragscroll.pkgd.js","sources":["../src/DragScroll.ts"],"sourcesContent":["import EventEmitter from \"@scena/event-emitter\";\nimport { now } from \"@daybrush/utils\";\nimport { DragScrollEvents, DragScrollOptions, Rect } from \"./types\";\n\nfunction getDefaultScrollPosition(e: { container: HTMLElement, direction: number[] }) {\n    const container = e.container;\n\n    return [\n        container.scrollLeft,\n        container.scrollTop,\n    ];\n}\n\nexport default class DragScroll extends EventEmitter<DragScrollEvents> {\n    private startRect: Rect | null = null;\n    private startPos: number[] = [];\n    private prevTime: number = 0;\n    private timer: number = 0;\n    public dragStart(e: any, options: DragScrollOptions) {\n        const {\n            top,\n            left,\n            width,\n            height,\n        } = options.container.getBoundingClientRect();\n\n        this.startPos = [e.clientX, e.clientY];\n        this.startRect = { top, left, width, height };\n    }\n    public drag(e: any, options: DragScrollOptions) {\n        const {\n            clientX,\n            clientY,\n        } = e;\n        const {\n            container,\n            threshold = 0,\n            throttleTime = 0,\n            getScrollPosition = getDefaultScrollPosition,\n        } = options;\n        const {\n            startRect,\n            startPos,\n        } = this;\n        const nowTime = now();\n        const distTime = Math.max(throttleTime + this.prevTime - nowTime, 0);\n\n        const direction = [0, 0];\n\n        if (startRect.top > clientY - threshold) {\n            if (startPos[1] > startRect.top || clientY < startPos[1]) {\n                direction[1] = -1;\n            }\n        } else if (startRect.top + startRect.height < clientY + threshold) {\n            if (startPos[1] < startRect.top + startRect.height || clientY > startPos[1]) {\n                direction[1] = 1;\n            }\n        }\n        if (startRect.left > clientX - threshold) {\n            if (startPos[0] > startRect.left || clientX < startPos[0]) {\n                direction[0] = -1;\n            }\n        } else if (startRect.left + startRect.width < clientX + threshold) {\n            if (startPos[0] < startRect.left + startRect.width || clientX > startPos[0]) {\n                direction[0] = 1;\n            }\n        }\n        clearTimeout(this.timer);\n\n        if (!direction[0] && !direction[1]) {\n            return false;\n        }\n        if (distTime > 0) {\n            this.timer = window.setTimeout(() => {\n                this.drag(e, options);\n            }, distTime);\n\n            return false;\n        }\n        this.prevTime = nowTime;\n        const prevPos = getScrollPosition({ container, direction });\n\n        this.trigger(\"scroll\", {\n            container,\n            direction,\n            inputEvent: e,\n        });\n\n        const nextPos = getScrollPosition({ container, direction });\n        const offsetX = nextPos[0] - prevPos[0];\n        const offsetY = nextPos[1] - prevPos[1];\n\n        if (!offsetX && !offsetY) {\n            return false;\n        }\n        this.trigger(\"move\", {\n            offsetX: direction[0] ? offsetX : 0,\n            offsetY: direction[1] ? offsetY : 0,\n            inputEvent: e,\n        });\n\n        if (throttleTime) {\n            this.timer = window.setTimeout(() => {\n                this.drag(e, options);\n            }, throttleTime);\n        }\n        return true;\n    }\n    public dragEnd() {\n        clearTimeout(this.timer);\n    }\n}\n"],"names":["getDefaultScrollPosition","e","container","scrollLeft","scrollTop","__extends","_this","options","_a","top","left","width","height","startPos","clientX","clientY","startRect","threshold","_b","throttleTime","_c","getScrollPosition","_d","nowTime","now","distTime","Math","max","prevTime","direction","clearTimeout","timer","window","setTimeout","drag","prevPos","trigger","inputEvent","nextPos","offsetX","offsetY","EventEmitter"],"mappings":"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"}